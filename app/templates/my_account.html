{% extends "base.html" %}
{% block content %}
<div class="container py-5">
  <h1 class="display-4 fw-bold hero-title">My Account</h1>
  <p class="lead text-muted mb-5">
    Manage your account details and update your credentials.
  </p>

  <div class="row">
    <div class="col-md-8">
      <!-- ‚öôÔ∏è Preferences Card -->
      <div class="card p-4 mb-4 bg-white">
        <h5 class="fw-bold mb-3">‚öôÔ∏è Preferences</h5>

        <form method="POST" action="{{ url_for('update_preferences') }}">
          <!-- Units Preference -->
          <!-- <div class="mb-3">
            <label class="form-label">Preferred Units</label>
            <select class="form-select" name="unit_preference">
              <option value="km" {% if current_user.unit_preference == 'km' %}selected{% endif %}>Kilometers</option>
              <option value="mi" {% if current_user.unit_preference == 'mi' %}selected{% endif %}>Miles</option>
            </select>
          </div> -->

          <!-- Activity Notification Toggle --> 
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" name="notify_group_activity" id="notifyGroupActivity"
              {% if current_user.notify_group_activity %}checked{% endif %}>
            <label class="form-check-label" for="notifyGroupActivity">
              Notify me when someone logs a new run in my groups
            </label>
          </div>

          <!-- Public Profile Toggle -->
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" name="is_public_profile" id="isPublicProfile"
              {% if current_user.is_public_profile %}checked{% endif %}>
            <label class="form-check-label" for="isPublicProfile">
              Make my profile public
            </label>
          </div>

          <!-- Public Profile URL (only if public) -->
        {% if current_user.is_public_profile %}
          <div class="mb-3">
            <label class="form-label">Your public profile URL</label>
            <div class="input-group">
              <input type="text" class="form-control" id="publicProfileURL" readonly
                    value="{{ url_for('public_profile', username=current_user.username, _external=True) }}">
              <button type="button" class="btn btn-outline-secondary" onclick="copyProfileURL(this)">Copy</button>
            </div>
            <small id="copyFeedback" class="form-text text-success d-none">Copied!</small>
          </div>

          <script>
            function copyProfileURL(button) {
              const input = document.getElementById("publicProfileURL");
              navigator.clipboard.writeText(input.value).then(() => {
                const feedback = document.getElementById("copyFeedback");
                feedback.classList.remove("d-none");
                setTimeout(() => {
                  feedback.classList.add("d-none");
                }, 2000);
              });
            }
          </script>
        {% endif %}


          <div class="text-end">
            <button type="submit" class="btn btn-dark">Save Preferences</button>
          </div>
        </form>
      </div>

      <!-- üîê Account Form -->
      <div class="card p-4 bg-white">
        <h5 class="fw-bold mb-3">üîê My account</h5>

        <form method="POST">
          {{ form.hidden_tag() }}

          <div class="mb-4">
            {{ form.username.label(class="form-label") }}
            {{ form.username(class="form-control") }}
            {% for error in form.username.errors %}
            <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>

          <div class="mb-4">
            {{ form.email.label(class="form-label") }}
            {{ form.email(class="form-control", value=form.email.data or user.email) }}
            {% if not user.is_verified %}
              <div class="form-text text-warning">This email is not verified.</div>
            {% endif %}
            {% for error in form.email.errors %}
                <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>

          <hr class="my-4">

          <div class="mb-4">
            {{ form.password.label(class="form-label") }}
            {{ form.password(class="form-control", placeholder="Leave blank to keep current password") }}
          </div>

          <div class="mb-4">
            {{ form.password2.label(class="form-label") }}
            {{ form.password2(class="form-control", placeholder="Re-enter new password") }}
          </div>

          <div class="text-end">
            {{ form.submit(class="btn btn-dark") }}
          </div>
        </form>
      </div>
    </div>

    <div class="col-md-4 d-none d-md-block">
      <div class="card shadow-sm bg-light border-0 p-3">
        <h6 class="text-muted mb-2">Security tips</h6>
        <p class="small mb-1">
          Use a strong and unique password to protect your account.
        </p>
        <p class="small mb-0">
          Changing your email will require verification and log you out for security reasons.
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %}
